<link rel="import" href="../polymer/polymer.html">
<script>
  /* @polymerBehavior Polymer.IoBase */
  Polymer.IoBase = {
    properties: {
      /**
       * Value
       */
      value: {
        value: null,
        notify: true,
        observer: '_valueChanged'
      },
      /**
       * Immediate value
       */
      immediatevalue: {
        value: null,
        observer: '_immediatevalueChanged'
      },
      /**
       * Determines if the input can be focused and edited by user action.
       */
      disabled: {
        value: false,
        type: Boolean,
        observer: '_disabledChanged',
        reflectToAttribute: true
      }
    },
    hostAttributes: {
      role: 'input'
    },
    listeners: {
      'mousedown': '_onMousedown',
      'contextmenu': '_onDblclick'
    },
    /**
     * Used to set value by user action.
     * Fires non-bubbling event io-value-set
     * @param {*} value new value to be set.
     */
    setValue: function(value) {
      if (value === this.value) return;
      var oldValue = this.value;
      this.value = value;
      /**
       * This event is fired when value is set by user action.
       * This is a non-bubbling event.
       * @event io-value-set
       * @param {Object} detail value change data
       * @param {Object} detail.value new value
       * @param {Object} detail.oldValue old value
       */
      this.fire('io-value-set', {value: value, oldValue: oldValue}, {bubbles: true});
    },
    _onMousedown: function(event) {
      // Blur currently focused
      if (document.activeElement !== this) {
        document.activeElement.blur();
      }
    },
    _disabledChanged: function() {
      if (this.disabled) {
        this.setAttribute('aria-disabled', '');
      } else {
        this.removeAttribute('aria-disabled');
      }
    },
    _valueChanged: function() {
      this.immediatevalue = this.value;
    },
    _immediatevalueChanged: function() {
    },
    _computePlaceholder: function(value) {
      if (typeof value === 'boolean') return String(value);
      else if (value === null) return 'null';
      else if (value === undefined) return 'undefined';
      else if (typeof value === 'number') return String(value);
      else if (typeof value === 'string' && value !== '') return value;
      else if (typeof value === 'function') return 'function';
      else if (typeof value === 'object') return 'object';
      else return String(value) || this.properties.placeholder.value;
    }
  };
</script>
